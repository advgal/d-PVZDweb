# Baseline config - requires additional config for command and django settings
version: "3.5"
services:
  pvzdweb:
    image: local/pvzdweb
    # container_name: pvzdweb # do not specify container name, it confuses docker-compose exec
    command: /opt/bin/start_webapps.sh
    labels:
      pvzdweb.jenkins:
    #deploy:
    #  placement:
    #    constraints:
    #      - node.hostname == nc8
    #  replicas: 1
    #  restart_policy:
    #    condition: on-failure
    environment:
      DJANGO_SETTINGS_MODULE: pvzdweb.settings_jenkins
      DJANGO_SECRET_KEY:
      DJANGO_DEBUG:
      PGHOST: postgres_ci
      CSRFSECRET:
      CSRFENCRYPTKEY:
    restart: unless-stopped
    networks:
      jenkins:
    volumes:
      - pvzdweb.config:/config:Z
      - mdreg.var_log:/var/log:Z
      - pvzdweb.settings:/opt/PVZDweb/pvzdweb:Z
      - pvzdweb.root:/root:Z

networks:
  jenkins:
    name: jenkins
    # driver: overlay
    # attachable: true

volumes:
  pvzdweb.config:
    name: pvzdweb.config
  mdreg.var_log:
    name: mdreg.var_log
  pvzdweb.settings:
    name: pvzdweb.settings
  pvzdweb.root:
    name: pvzdweb.root
